{% load static %}
{% load app_tags %}
<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="TG Code">
    <title>Treasury</title>

    <link rel="icon" href="{% static 'assets/img/brand/favicon.png' %}" type="image/png">
    <link rel="stylesheet" href="{% static 'assets/libs/animate.css/animate.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/@fortawesome/fontawesome-free/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/ionicons/css/ionicons.css' %}">


    <link rel="stylesheet" href="{% static 'assets/libs/swiper/dist/css/swiper.min.css' %}">

    <!-- Custom style -->
    <link rel="stylesheet" href="{% static 'assets/css/mega/style.css' %}" id="stylesheet">
    <link rel="stylesheet" href="{% static 'assets/css/quick-website.css' %}" id="stylesheet">
    <link rel="stylesheet" href="{% static 'assets/css/custom.css' %}" id="stylesheet">

</head>

<body>

{% include 'app/basic/navbar.html' %}

<section class="page-banner" style="background: #181717; padding-bottom: 0;">
    <div class="container-fluid">
        <div class="page-title"> Change reset </div>
        <div class="user-email"><span class="font-weight-bolder">Email</span>: test@gmail.com
        </div>
    </div>
</section>

<section class="container-fluid page-subtitle">

    {% block tab_menu %}
    <div style="text-align: center">
         <a href="{% url 'app:login' %}">
             <span class="px-2 d-md-inline-flex d-sm-block tab active">
                Login
             </span>
         </a>
        <a href="{% url 'app:login' %}">
            <span class="px-2 d-md-inline-flex d-sm-block tab " style="border-left: 1px solid grey;">
                 Create Account
            </span>
        </a>
        <a href="{% url 'app:password_reset' %}">
            <span class="px-2 d-md-inline-flex d-sm-block tab " style="border-left: 1px solid grey;">
                 Reset Password
            </span>
        </a>
    </div>
    {% endblock %}

</section>


<section class="body">

    <div class="container p-lg-20-60" style="max-width: 400px;" >

    {% block tab_body %}
        <form action="" method="post" enctype="multipart/form-data" id="login-frm" >
            {% if result_dic.error != '' %}
                <div id="error-msg">{{ result_dic.error }}</div>
                <fieldset disabled="disabled">
            {% else %}
                {% if not result_dic.results.is_exist == "True" %}
                    <div id="init-msg">Your Key doesn't exist.</div>
                    <fieldset disabled="disabled">
                {% elif not result_dic.results.is_active == "True" %}
                    <div id="init-msg">Your Key is expired.</div>
                    <fieldset disabled="disabled">
                {% endif %}
            {% endif %}

            <label class="form-control-label mt-4" for="input-password">New password</label>
            <input class="form-control" id="input-password" name="password" placeholder="Put Email" type="email" value="new.account@treasuryquants.com">
            <label class="form-control-label" for="input-password">Confirm password</label>
            <input class="form-control" id="input-password-confirm" name="password_confirm" placeholder="Put Email" type="email" value="new.account@treasuryquants.com">
            <button class="btn btn-primary mt-4 pull-right" style="float: right" type="button" onclick="account_password_reset()">Reset</button>
            <div style="clear: both"></div>
            {% if result_dic.error %}
                </fieldset>
            {% endif %}
        </form>
    {% endblock %}
        <div id="msg"></div>
    </div>


</section>



{% include "app/basic/footer.html" %}

<!-- Core JS  -->
<script src="{% static 'assets/js/jquery.js' %}"></script>
<script src="{% static 'assets/js/jquery.migrate.js' %}"></script>

<script src="{% static 'assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'assets/libs/svg-injector/dist/svg-injector.min.js' %}"></script>
<script src="{% static 'assets/libs/feather-icons/dist/feather.min.js' %}"></script>
<!-- Optional JS -->
<script src="{% static 'assets/libs/in-view/dist/in-view.min.js' %}"></script>
<script src="{% static 'assets/libs/sticky-kit/dist/sticky-kit.min.js' %}"></script>
<script src="{% static 'assets/libs/imagesloaded/imagesloaded.pkgd.min.js' %}"></script>
<!-- Page JS -->
<script src="{% static 'assets/libs/bootstrap-notify/bootstrap-notify.min.js' %}"></script>
<script src="{% static 'assets/libs/autosize/dist/autosize.min.js' %}"></script>
<script src="{% static 'assets/libs/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js' %}"></script>
<script src="{% static 'assets/libs/easescroll/jquery.easeScroll.js' %}"></script>
<script src="{% static 'assets/libs/owl.carousel/owl.carousel.js' %}"></script>
<!-- Quick JS -->

<script src="{% static 'assets/js/e-magz.js' %}"></script>
<script src="{% static 'assets/js/quick-website.js' %}"></script>


<!-- Feather Icons -->
<script>
    feather.replace({
        'width': '1em',
        'height': '1em'
    });


    function account_password_reset(){
        let password = $('#input-password').val();
        let confirm_password = $('#input-password-confirm').val();
        msg_text = ''
        if(password.length < 10){
            msg_text = 'Password must be at least 10 characters.';
        }
        if(password !== confirm_password){
            msg_text += 'Password not matched.';
        }
        if(msg_text){
            $('#msg').text(msg_text);
            return;
        }

        let token = '{{csrf_token}}';
        $.ajax({
            headers: {
                "X-CSRFToken": token
            },
            type: 'post',
            url: "{% url 'app:account_api' %}",
            data:JSON.stringify({
                'function_name': 'account_password_reset',
                'arguments': {
                    'new_password': password,
                    'activation_key': '{{ key }}'
                },
                'source_caller': document.location.href,
            }),
            success: function (data){
               if (data.error){
                      $('#msg').text(data['error']);
               }
               else{
                      $('#msg').html(`Password reseted successfully. <a href="{% url 'app:logout' %}">Please login using new password. </a>`)

               }
            }
        });

    }



</script>

</body>

</html>