{% load static %}
{% load app_tags %}
<!DOCTYPE html>
<html lang="en">


<head>
    <title>Treasury Quants</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/custom.css' %}">
    <link rel="icon" href="{% static 'assets/images/favicon.png' %}" type="image/png">
</head>

<body>

{% include 'app/basic/navbar.html' %}

<section class="mid">
    {% include 'app/basic/middle_office.html' %}
    <section class="middle-office">
        <div class="container-fluid" style="max-width: 1600px;">

            <div class="user-information">
                <div class="grid-mother">
                    <div>
                        <p>IP:</p>
                        <p id="ip"></p>
                    </div>
                    <div>
                        <p>Token:</p>
                        <p id="token"></p>
                    </div>
                    <div>
                        <p>Token Expiry:</p>
                        <p id="token_expiry"></p>
                    </div>
                    <div>
                        <p>Email:</p>
                        <p id="email"></p>
                    </div>
                    <div>
                        <p>Balance:</p>
                        <p id="balance">0.00</p>
                    </div>
                    <div>
                        <p>User-id:</p>
                        <p id="client_id"></p>
                    </div>

                </div>

            </div>
            <div class="data-table">
                <div class="grid-board">
                    <div>
                        <div class="board-title">API</div>
                        <div class="board-list">
                            <div>
                                <select id="api-list" name="api-list" onchange="print_form(this.value)">
                                </select>
                            </div>

                        </div>
                        <div class="board-main">
                            <div id="api-entries"></div>
                        </div>
                        <div class="board-footer">
                            <button id="calculate-button" class="btn btn-primary btn-block" onclick="calculate()">
                                CALCULATE
                                <span class="spinner-border spinner-border-sm" id="loading-icon-calculate" role="status"
                                      aria-hidden="true"> </span>
                            </button>
                        </div>

                    </div>
                    <div class="board-output">
                        <div class="board-title">Output</div>
                        <div class="board-main" id="output">
                            <!--                            {% for item in list %}-->
                                <!--                                <div class="form-group row" >-->
                                <!--                                    <label class="col-6 col-form-label font-weight-bold">price{{ item }}:</label>-->
                                <!--                                    <label class="col-6 col-form-label ">16205189.025432</label>-->
                                <!--                                </div>-->
                                <!--                            {% endfor %}-->
                            <!--                            {% for item in list %}-->
                                <!--                                <div class="form-group row">-->
                                <!--                                    <label class="col-6 col-form-label font-weight-bold">price{{ item }}:</label>-->
                                <!--                                    <label class="col-6 col-form-label ">16205189.025432</label>-->
                                <!--                                </div>-->
                                <!--                            {% endfor %}-->
                        </div>

                    </div>
                    <div class="board-output">
                        <div class="board-title">Description</div>
                        <div id="description" class="board-main">
                        </div>
                    </div>

                </div>
            </div>

            <div class="grid-feedback">
                <div></div>
                <div></div>
                <div class="text-primary" id="send-feedback">
                    <span>
                        <i class="mr-1" data-feather="edit"></i>
                        <span>Send Feedback</span>
                    </span>
                </div>
            </div>
            <div class="log">
                <div class="board-title">Log</div>
                <div class="board-main" id="log"></div>
            </div>
        </div>
    </section>


</section>

<div class="modal fade" id="feedback-modal" tabindex="-1" role="dialog" aria-labelledby="change-video-data"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title d-flex align-items-center" id="modal-title-change-username">
                    <div>
                        <h4 class="mb-0 font-weight-bold">Let us know what we are missing...</h4>
                    </div>
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mb-3">
                <textarea class="form-control" placeholder="Put your feedback" id="feedback-content"
                          maxlength="300"></textarea>

                <div class="mt-3"></div>
                <button class="btn btn-primary btn-block" style="float: right; " onclick="send_feedback()">Send Feedback
                    <span class="spinner-border spinner-border-sm" id="loading-icon-feedback" role="status"
                          aria-hidden="true"> </span></button>
                <div style="clear: both"></div>
                <div id="msg" class="mt-2"></div>
            </div>
        </div>
    </div>
</div>


<!-- Core JS  -->
<script src="{% static 'assets/js/jquery-2.1.3.min.js' %}"></script>
<script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/chart.js' %}"></script>
<script src="{% static 'assets/libs/feather-icons/dist/feather.min.js' %}"></script>
<script src="{% static 'assets/js/custom.js' %}"></script>
<script>
    var url = "{{ target_ip|safe }}";
    var email = "{{ user_email|default:"" }}";
    var descriptions = {{ descriptions | safe }};
</script>
<script src="{% static 'assets/js/workbench.js' %}"></script>

{% include 'app/basic/js.html' %}

<script>

    /*
    Notes
    =====
    This page is meant to be a simple workbench exposing our apis to the user.
    Like any function, our apis will have different number of input arguments as well as output results.
    Furthermore, each argument and each result will have different types: some numbers, some strings, list, etc.
    The objective of the design is to introduce these apis in a cohesive and intuitive manner
    The design is simple. User selects an api name (function name) from the main combo list from the top.
    A dynamic Form is then created based on the chosen api's specification. Once the final submission
    button is clicked, there will be a validation, request creation and an api call over http. The results
    are then parsed and placed in various locations on the screen. So the key to the design is the api specifications.

    API Specification
    =================
    Each api specification provides the arguments, argument_labels, argument_types and argument_optionals.
    - arguments are used when building the api request
    - argument_labels are used to print the argument names in a more user friendly manner
    - argument_types are used to create the appropriate input fields as well as validating the input values
    - argument_optionals are used for validating the input and accepting empty values.
    - argument_values are the initial values to be set at. When it is set at "last" we will set the last entry as selected .When it is set at "previous" we will set the one before the last entry as selected.

    Data Type Specification
    =======================
    Data types used for argument_type processing cover a range of types from number to various combo lists.

    Each type covers type, width and init_values .
    - type is the type name that is used to distinguish this type from others.
    - width is the width of the input filed that is meant to be the same for each type all its instantiations.
    - init_values are used for combo list.
    * note: there are two types that are dynamic: 1) TYPE_MARKET_DATES and 2) TYPE_TRADE_LIST. TYPE_MARKET_DATES should be populated only once and only when the page is loaded. TYPE_TRADE_LIST is populated at the beginning and at each time a trade is saved.
    */


    /******************************** End *********************************/


    //intialize

    $('#email').text(email);
    initial_load(email, descriptions);

    async function send_feedback() {

        let email = $('#email').text();
        let message = $('#feedback-content').val();
        if (!message) {
            $('#msg').html('Fill out feedback!');
            return false;
        }
        $('#loading-icon-feedback').css('display', 'inline-block');
        let res = await post_message1('Feedback from ' + email, message, $('#msg'));
        $('#feedback-modal').modal('hide');
        $('#loading-icon-feedback').css('display', 'none');
    }


</script>
{% include "app/basic/footer.html" %}

</body>

</html>


