{% load static %}
{% load app_tags %}
<!DOCTYPE html>
<html lang="pl">

<head>
    <title>Treasury Quants</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/custom.css' %}">
    <link rel="icon" href="{% static 'assets/images/favicon.png' %}" type="image/png">

</head>

<body>

{% include 'app/basic/navbar.html' %}

<section class="mid">
    {% include 'app/basic/middle_office.html' %}


    <section style=" margin-top: 10px">
        <div class="container d-flex justify-content-center ">
            <div class="profile-table mt-4">
                <h3 class="font-weight-bold">Activate Account</h3>

                {% if result_dic.error != '' %}
                    <div id="error-msg">{{ result_dic.error }}</div>
                {% else %}
                    {% if not result_dic.results.is_exist == "True" %}
                        <div id="init-msg">Your Key doesn't exist.</div>
                    {% elif not result_dic.results.is_active == "True" %}
                        <div id="init-msg">Your Key is expired.</div>
                    {% else %}
                        <div id="init-msg"></div>
                    {% endif %}
                {% endif %}

                <div class="msg"></div>
            </div>

        </div>

    </section>

    {% include "app/basic/license.html" %}

</section>


{% include "app/basic/footer.html" %}

<!-- Core JS  -->
<script src="{% static 'assets/js/jquery-2.1.3.min.js' %}"></script>
<script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/libs/feather-icons/dist/feather.min.js' %}"></script>
<script src="{% static 'assets/libs/ip_input/ipInput.js' %}"></script>

{% include "app/basic/js.html" %}
<script src="{% static 'assets/js/custom.js' %}"></script>


<script>

    account_activate();

    function account_activate_callback(data) {
        if (data.error) {
            msg_show(ele_msg, data['error']);
            post_message("account_activate", data.error);
        } else {
            msg_show(ele_msg, `Account activated. <a class="text-primary" href="{% url 'account_cycle:login' %}">Login. </a>`);
        }
    }


    function account_activate() {

        if ($('#init-msg').text()) {
            return false;
        }
        let token = '{{csrf_token}}';
        let arguments =  { 'activation_key': '{{ key }}'};
        call_account_api(token, 'account_activate', arguments, account_activate_callback);

    }

</script>

</body>

</html>